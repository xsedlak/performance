#!/bin/bash

#INIT_START
export RESULTS_DIR=${RES_DIR:-${RESULTS_DIR:-"RESULTS_DIR_VALUE"}}
export DATA_DIR="DATA_DIR_VALUE"
export APPS_DIR="APPS_DIR_VALUE"
export BENCHMARK_DIR="BENCHMARK_DIR_VALUE"
export JAVA_HOME="JAVA_HOME_VALUE"
export JAVA_OPTS="JAVA_OPTS_VALUE"
export JAVA_VERSION="JAVA_VERSION_VALUE"
export ZMD_STOP="ZMD_STOP_VALUE"
export ZMD_RESTART="ZMD_RESTART_VALUE"
export CLUSTER="CLUSTER_VALUE"
export NODES="NODES_VALUE"
export COMPRESSION="COMPRESSION_VALUE"
export RESTART_VM="RESTART_VM_VALUE"
export YCSB_HOME="YCSB_HOME_VALUE"
export YCSB_JAVA_HOME="YCSB_JVM_HOME_VALUE"
export YCSB_JAVA_OPTS="YCSB_JVM_OPTS_VALUE"
export APP_NAME="APP_NAME_VALUE"
export CUSTOM_SCRIPT="CUSTOM_SCRIPT_VALUE"
export USE_HDR="USE_HDR_VALUE"
export USE_TOP="USE_TOP_VALUE"
export USE_MPSTAT="USE_MPSTAT_VALUE"
export USE_NODETOOL="USE_NODETOOL_VALUE"
export NUMACTL_YCSB="NUMACTL_YCSB_VALUE"
export NUMACTL_ARGS="NUMACTL_ARGS_VALUE"
export SCORE_LATENCY="SCORE_LATENCY_VALUE"
export CLIENT_TLS="CLIENT_TLS_VALUE"
export SLA_CONFIG="SLA_CONFIG_VALUE"
#INIT_END

#MKDIR_START
echo "Precreating results dir: ${RESULTS_DIR}"
mkdir -p "${RESULTS_DIR}" || exit 1
#MKDIR_END

#RUN_START
echo "Running benchmark..."
bash "${BENCHMARK_DIR}/run.sh" "WORKLOAD_VALUE//WORKLOAD_ARGS_VALUE" &> "${RESULTS_DIR}/run.log"
#RUN_END

#RESULTS_START
echo "Processing bechmark results..."
bash "${BENCHMARK_DIR}/process_results.sh" "${RESULTS_DIR}" &> "${RESULTS_DIR}/process_results.log"
#RESULTS_END

echo "Done"
